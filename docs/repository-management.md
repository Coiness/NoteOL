# 仓库管理模块 (Repository Management)

## 功能概述

仓库管理模块负责知识库（文件夹）的创建、管理和组织。用户可以通过仓库对笔记进行分类整理，每个仓库可以有自己的颜色标识和描述信息。

## 实现方式

### 技术栈

- **React Query**: 数据获取和状态管理
- **React Hook Form**: 表单处理
- **Zod**: 表单验证
- **Prisma**: 数据库操作
- **Tailwind CSS**: 样式和颜色选择

### 核心功能

1. **仓库CRUD**: 创建、读取、更新、删除仓库
2. **默认仓库**: 自动创建和管理用户的默认知识库
3. **颜色标识**: 为每个仓库设置自定义颜色
4. **权限控制**: 确保用户只能操作自己的仓库
5. **级联删除**: 删除仓库时保留笔记但移除分类关联

### 数据库设计

- **Repository 表**: 存储仓库基本信息
- **NoteRepository 表**: 多对多关联表，连接笔记和仓库
- **默认仓库**: 通过 isDefault 字段标识用户的默认仓库

## 重要文件

### 核心组件

- `components/repository/repository-list.tsx`: 仓库列表展示和操作
- `components/repository/repository-dialog.tsx`: 仓库创建和编辑对话框

### 页面文件

- `app/(main)/repositories/page.tsx`: 仓库管理主页面

### API 路由

- `app/api/repositories/route.ts`: 仓库 CRUD API
- `app/api/repositories/[id]/route.ts`: 单个仓库操作 API

### 类型和验证

- `types/repository.ts`: 仓库相关 TypeScript 类型
- `lib/validations/repository.ts`: 仓库表单验证规则

## 亮点

1. **用户体验**: 直观的卡片式布局，支持悬停显示操作菜单
2. **视觉标识**: 颜色标记帮助用户快速区分不同仓库
3. **默认仓库**: 自动处理默认仓库的创建和管理
4. **权限安全**: 服务端严格的权限检查
5. **响应式设计**: 支持不同屏幕尺寸的适配

## 注意事项和坑

1. **默认仓库保护**: 默认仓库不能被删除，需要特殊处理
2. **级联关系**: 删除仓库时需要正确处理笔记的关联关系
3. **颜色存储**: 颜色值需要正确的格式验证和存储
4. **权限验证**: 创建仓库时需要验证用户身份
5. **数据一致性**: 确保仓库删除不会影响笔记数据的完整性
6. **UI 状态**: 编辑对话框需要正确重置表单状态
7. **错误处理**: 需要处理仓库名重复等边界情况

## 依赖关系

- 依赖于认证模块获取用户身份
- 与笔记管理模块通过 NoteRepository 关联
- 使用 UI 组件库提供界面元素
- 使用工具库的 utilities 函数
