# 数据库与 API (Database & API)

## 功能概述

数据库与 API 模块提供数据持久化和 RESTful API 接口，支持笔记、用户、仓库等实体的 CRUD 操作。

## 实现方式

### 技术栈

- **Prisma**: ORM 和数据库迁移
- **PostgreSQL**: 主数据库
- **Next.js API Routes**: 服务端 API
- **Zod**: API 数据验证

### 核心功能

1. **数据建模**: 用户、笔记、仓库、协作等数据模型
2. **API 路由**: RESTful API 接口设计
3. **数据验证**: 请求数据验证和错误处理
4. **权限控制**: 基于角色的访问控制

## 重要文件

### 数据库文件

- `prisma/schema.prisma`: 数据库模式定义
- `prisma/migrations/`: 数据库迁移文件
- `lib/prisma.ts`: Prisma 客户端配置

### API 文件

- `app/api/`: 所有 API 路由
- `lib/api-response.ts`: API 响应工具
- `lib/validations/`: 数据验证规则

## 亮点

1. **类型安全**: Prisma 生成的类型定义
2. **迁移管理**: 版本化的数据库迁移
3. **错误处理**: 统一的 API 错误响应格式
4. **性能优化**: 数据库查询优化和索引

## 注意事项和坑

1. **迁移冲突**: 团队开发时的迁移冲突处理
2. **数据一致性**: 事务处理和外键约束
3. **性能监控**: 慢查询和数据库连接池管理
4. **备份恢复**: 数据备份和灾难恢复策略
